#!/usr/bin/env python3
# -*- coding:utf-8 -*-

import argparse

SYSCALLS = [
    "NtCreateProcess",
    "NtCreateProcessEx",
    "NtCreateUserProcess",
    "NtSetInformationProcess",
    "NtQueryInformationProcess",
    "NtQueryObject",
    "NtQuerySystemInformation",
    "NtQuerySystemInformationEx",
    "NtSetSystemInformation",
    "NtSetInformationThread",
    "NtQueryInformationThread",
    "NtUnmapViewOfSection",
    "NtUnmapViewOfSectionEx",
    "NtExtendSection",
    "NtSuspendThread",
    "NtResumeThread",
    "NtSuspendProcess",
    "NtResumeProcess",
    "NtGetCurrentProcessorNumber",
    "NtSignalAndWaitForSingleObject",
    "NtWaitForSingleObject",
    "NtWaitForMultipleObjects",
    "NtWaitForMultipleObjects32",
    "NtSetSecurityObject",
    "NtQuerySecurityObject",
    "NtQueueApcThread",
    "NtQueueApcThreadEx",
    "NtProtectVirtualMemory",
    "NtFlushBuffersFile",
    "NtFlushInstructionCache",
    "NtFlushWriteBuffer",
    "NtFsControlFile",
    "NtLockFile",
    "NtUnlockFile",
    "NtFlushVirtualMemory",
    "NtQueryVirtualMemory",
    "NtLockVirtualMemory",
    "NtUnlockVirtualMemory",
    "NtSystemDebugControl",
    "NtShutdownSystem",
    "NtDisplayString",
    "NtDrawText",
    "NtYieldExecution",
    "NtClose",
    "NtQueryAttributesFile",
    "NtQueryFullAttributesFile",
    "NtQueryInformationByName",
    "NtQueryInformationFile",
    "NtSetInformationFile",
    "NtSetQuotaInformationFile",
    "NtSetVolumeInformationFile",
    "NtCreateFile",
    "NtCreateNamedPipeFile",
    "NtCreateMailslotFile",
    "NtCancelIoFile",
    "NtCancelIoFileEx",
    "NtCancelSynchronousIoFile",
    "NtCreateSymbolicLinkObject",
    "NtOpenSymbolicLinkObject",
    "NtQuerySymbolicLinkObject",
    "NtGetContextThread",
    "NtSetContextThread",
    "NtOpenProcess",
    "NtTerminateProcess",
    "NtGetNextProcess",
    "NtGetNextThread",
    "NtCreateDebugObject",
    "NtDebugActiveProcess",
    "NtContinue",
    "NtRaiseException",
    "NtCreateThread",
    "NtCreateThreadEx",
    "NtCreateJobObject",
    "NtOpenJobObject",
    "NtAssignProcessToJobObject",
    "NtTerminateJobObject",
    "NtIsProcessInJob",
    "NtQueryInformationJobObject",
    "NtSetInformationJobObject",
    "NtCreateJobSet",
    "NtAllocateReserveObject",
    "NtRegisterThreadTerminatePort",
    "NtRaiseHardError",
    "NtAllocateVirtualMemory",
    "NtFreeVirtualMemory",
    "NtReadVirtualMemory",
    "NtWriteVirtualMemory",
    "NtAllocateUserPhysicalPages",
    "NtMapUserPhysicalPages",
    "NtMapUserPhysicalPagesScatter",
    "NtFreeUserPhysicalPages",
    "NtQuerySection",
    "NtAreMappedFilesTheSame",
    "NtCreateSection",
    "NtCreateSectionEx",
    "NtOpenSection",
    "NtMapViewOfSection",
    "NtMapViewOfSectionEx",
    "NtOpenSession",
    "NtNotifyChangeDirectoryFile",
    "NtNotifyChangeDirectoryFileEx",
    "NtOpenFile",
    "NtQueryDirectoryFile",
    "NtQueryDirectoryFileEx",
    "NtQueryEaFile",
    "NtSetEaFile",
    "NtLoadDriver",
    "NtUnloadDriver",
    "NtReadFile",
    "NtReadFileScatter",
    "NtWriteFileGather",
    "NtDeleteFile",
    "NtWriteFile",
    "NtDeviceIoControlFile",
    "NtSetInformationObject",
    "NtDuplicateObject",
    "NtMakePermanentObject",
    "NtMakeTemporaryObject",
    "NtCreateDirectoryObject",
    "NtOpenDirectoryObject",
    "NtQueryDirectoryObject",
    "NtCreatePrivateNamespace",
    "NtOpenPrivateNamespace",
    "NtDeletePrivateNamespace",
    "NtOpenThread",
    "NtTerminateThread",
    "NtQuerySystemTime",
    "NtSetSystemTime",
    "NtQueryTimerResolution",
    "NtSetTimerResolution",
    "NtQueryPerformanceCounter",
    "NtAllocateLocallyUniqueId",
    "NtSetUuidSeed",
    "NtAllocateUuids",
    "NtCreateEvent",
    "NtOpenEvent",
    "NtSetEvent",
    "NtResetEvent",
    "NtClearEvent",
    "NtQueryQuotaInformationFile",
    "NtQueryVolumeInformationFile",
    "NtCreateKey",
    "NtCreateKeyTransacted",
    "NtOpenKey",
    "NtOpenKeyTransacted",
    "NtOpenKeyEx",
    "NtOpenKeyTransactedEx",
    "NtDeleteKey",
    "NtRenameKey",
    "NtDeleteValueKey",
    "NtQueryKey",
    "NtSetInformationKey",
    "NtQueryValueKey",
    "NtSetValueKey",
    "NtQueryMultipleValueKey",
    "NtEnumerateKey",
    "NtEnumerateValueKey",
    "NtFlushKey",
    "NtCompactKeys",
    "NtCompressKey",
    "NtLoadKey",
    "NtLoadKey2",
    "NtLoadKeyEx",
    "NtReplaceKey",
    "NtSaveKey",
    "NtSaveKeyEx",
    "NtSaveMergedKeys",
    "NtRestoreKey",
    "NtUnloadKey",
    "NtUnloadKey2",
    "NtUnloadKeyEx",
    "NtNotifyChangeKey",
    "NtNotifyChangeMultipleKeys",
    "NtQueryOpenSubKeys",
    "NtQueryOpenSubKeysEx",
    "NtInitializeRegistry",
    "NtLockRegistryKey",
    "NtLockProductActivationKeys",
    "NtFreezeRegistry",
    "NtThawRegistry",
    "NtDelayExecution",
    "NtCallbackReturn",
    "NtFlushProcessWriteBuffers",
    "NtQueryDebugFilterState",
    "NtSetDebugFilterState",
    "NtRemoveProcessDebug",
    "NtWaitForDebugEvent",
    "NtDebugContinue",
    "NtSetInformationDebugObject",
    "NtOpenProcessToken",
    "NtOpenProcessTokenEx",
    "NtOpenThreadToken",
    "NtOpenThreadTokenEx",
    "NtCreateToken",
    "NtDuplicateToken",
    "NtQueryInformationToken",
    "NtAdjustPrivilegesToken",
    "NtAdjustGroupsToken",
    "NtFilterToken",
    "NtSetInformationToken",
    "NtCompareTokens",
    "NtPrivilegeCheck",
    "NtImpersonateAnonymousToken",
    "NtQuerySecurityAttributesToken",
    "NtAccessCheck",
    "NtAccessCheckByType",
    "NtAccessCheckByTypeResultList",
    "NtCreateIoCompletion",
    "NtOpenIoCompletion",
    "NtQueryIoCompletion",
    "NtSetIoCompletion",
    "NtSetIoCompletionEx",
    "NtRemoveIoCompletion",
    "NtRemoveIoCompletionEx",
    "NtCreateWaitCompletionPacket",
    "NtAssociateWaitCompletionPacket",
    "NtCancelWaitCompletionPacket",
    "NtNotifyChangeSession",
    "NtCreateMutant",
    "NtOpenMutant",
    "NtReleaseMutant",
    "NtAlertThread",
    "NtAlertResumeThread",
    "NtTestAlert",
    "NtImpersonateThread",
    "NtCreateSemaphore",
    "NtOpenSemaphore",
    "NtReleaseSemaphore",
    "NtQuerySemaphore",
    "NtCreateTimer",
    "NtOpenTimer",
    "NtSetTimer",
    "NtSetTimerEx",
    "NtCancelTimer",
    "NtQueryTimer",
    "NtCreateKeyedEvent",
    "NtOpenKeyedEvent",
    "NtReleaseKeyedEvent",
    "NtWaitForKeyedEvent",
    "NtUmsThreadYield",
    "NtCreateTransactionManager",
    "NtOpenTransactionManager",
    "NtRenameTransactionManager",
    "NtRollforwardTransactionManager",
    "NtRecoverTransactionManager",
    "NtQueryInformationTransactionManager",
    "NtSetInformationTransactionManager",
    "NtEnumerateTransactionObject",
    "NtCreateTransaction",
    "NtOpenTransaction",
    "NtQueryInformationTransaction",
    "NtSetInformationTransaction",
    "NtCommitTransaction",
    "NtRollbackTransaction",
    "NtCreateEnlistment",
    "NtOpenEnlistment",
    "NtQueryInformationEnlistment",
    "NtSetInformationEnlistment",
    "NtRecoverEnlistment",
    "NtPrePrepareEnlistment",
    "NtPrepareEnlistment",
    "NtCommitEnlistment",
    "NtRollbackEnlistment",
    "NtPrePrepareComplete",
    "NtPrepareComplete",
    "NtCommitComplete",
    "NtReadOnlyEnlistment",
    "NtRollbackComplete",
    "NtSinglePhaseReject",
    "NtCreateResourceManager",
    "NtOpenResourceManager",
    "NtRecoverResourceManager",
    "NtGetNotificationResourceManager",
    "NtQueryInformationResourceManager",
    "NtSetInformationResourceManager",
    "NtRegisterProtocolAddressInformation",
    "NtPropagationComplete",
    "NtPropagationFailed",
    "NtFreezeTransactions",
    "NtThawTransactions",
    "NtCreateWorkerFactory",
    "NtQueryInformationWorkerFactory",
    "NtSetInformationWorkerFactory",
    "NtShutdownWorkerFactory",
    "NtReleaseWorkerFactoryWorker",
    "NtWorkerFactoryWorkerReady",
    "NtWaitForWorkViaWorkerFactory",
    "ZwWaitForWorkViaWorkerFactory",
    "NtQuerySystemEnvironmentValue",
    "NtSetSystemEnvironmentValue",
    "NtQuerySystemEnvironmentValueEx",
    "NtSetSystemEnvironmentValueEx",
    "NtEnumerateSystemEnvironmentValuesEx",
    "NtAddBootEntry",
    "NtDeleteBootEntry",
    "NtModifyBootEntry",
    "NtEnumerateBootEntries",
    "NtQueryBootEntryOrder",
    "NtSetBootEntryOrder",
    "NtQueryBootOptions",
    "NtSetBootOptions",
    "NtTranslateFilePath",
    "NtAddDriverEntry",
    "NtDeleteDriverEntry",
    "NtModifyDriverEntry",
    "NtEnumerateDriverEntries",
    "NtQueryDriverEntryOrder",
    "NtSetDriverEntryOrder",
    "NtSerializeBoot",
    "NtEnableLastKnownGood",
    "NtDisableLastKnownGood",
    "DbgPrint",
    "DbgPrintEx",
    "DbgBreakPoint",
    "DbgUiConnectToDbg",
    "DbgUiGetThreadDebugObject",
    "DbgUiSetThreadDebugObject",
    "DbgUiWaitStateChange",
    "DbgUiContinue",
    "DbgUiStopDebugging",
    "DbgUiDebugActiveProcess",
    "DbgUiRemoteBreakin",
    "DbgUiIssueRemoteBreakin",
    "DbgUiConvertStateChangeStructure",
    "LdrLoadDll",
    "LdrGetDllHandle",
    "LdrGetDllHandleEx",
    "LdrGetDllHandleByMapping",
    "LdrGetDllHandleByName",
    "LdrGetProcedureAddress",
    "LdrGetProcedureAddressEx",
    "LdrLockLoaderLock",
    "LdrUnlockLoaderLock",
    "LdrProcessRelocationBlock",
    "LdrUnloadDll",
    "LdrDisableThreadCalloutsForDll",
    "LdrOpenImageFileOptionsKey",
    "LdrQueryImageFileKeyOption",
    "LdrVerifyImageMatchesChecksum",
    "LdrVerifyImageMatchesChecksumEx",
    "LdrAccessResource",
    "RtlAssert",
    "RtlRaiseStatus",
    "RtlRaiseException",
    "RtlConnectToSm",
    "RtlSendMsgToSm",
    "RtlRegisterThreadWithCsrss",
    "RtlEnterCriticalSection",
    "RtlLeaveCriticalSection",
    "RtlIsCriticalSectionLocked",
    "RtlIsCriticalSectionLockedByThread",
    "RtlGetCriticalSectionRecursionCount",
    "RtlTryEnterCriticalSection",
    "RtlInitializeCriticalSection",
    "RtlEnableEarlyCriticalSectionEventCreation",
    "RtlInitializeCriticalSectionAndSpinCount",
    "RtlSetCriticalSectionSpinCount",
    "RtlDeleteCriticalSection",
    "RtlQueryPerformanceFrequency",
    "RtlQueryPerformanceCounter",
    "RtlGetCompressionWorkSpaceSize",
    "RtlCompressBuffer",
    "RtlDecompressBuffer",
    "RtlDecompressBufferEx",
    "RtlDecompressBufferEx2",
    "RtlDecompressFragment",
    "RtlDecompressFragmentEx",
    "RtlDescribeChunk",
    "RtlReserveChunk",
    "RtlDecompressChunks",
    "RtlCompressChunks",
    "RtlCreateHeap",
    "RtlDestroyHeap",
    "RtlAllocateHeap",
    "RtlFreeHeap",
    "RtlWalkHeap",
    "RtlQueryHeapInformation",
    "RtlSetHeapInformation",
    "RtlSizeHeap",
    "RtlZeroHeap",
    "RtlProtectHeap",
    "RtlLockHeap",
    "RtlUnlockHeap",
    "RtlReAllocateHeap",
    "RtlGetUserInfoHeap",
    "RtlSetUserValueHeap",
    "RtlSetUserFlagsHeap",
    "RtlCreateTagHeap",
    "RtlQueryTagHeap",
    "RtlCompactHeap",
    "RtlValidateHeap",
    "RtlValidateProcessHeaps",
    "RtlGetProcessHeaps",
    "RtlEnumProcessHeaps",
    "RtlTimeToTimeFields",
    "RtlUniform",
    "RtlRandom",
    "RtlRandomEx",
    "RtlFindMessage",
    "RtlFormatMessage",
    "RtlNtStatusToDosError",
    "RtlNtStatusToDosErrorNoTeb",
    "RtlGetLastNtStatus",
    "RtlGetLastWin32Error",
    "RtlSetLastWin32ErrorAndNtStatusFromNtStatus",
    "RtlSetLastWin32Error",
    "RtlRestoreLastWin32Error",
    "RtlGetThreadErrorMode",
    "RtlSetThreadErrorMode",
    "RtlCreateUnicodeString",
    "RtlUpcaseUnicodeString",
    "RtlInitUnicodeString",
    "RtlInitUnicodeStringEx",
    "RtlInitAnsiString",
    "RtlCopyUnicodeString",
    "RtlAppendUnicodeToString",
    "RtlAnsiStringToUnicodeString",
    "RtlUnicodeStringToAnsiString",
    "RtlUpperChar",
    "RtlPrefixString",
    "RtlAppendStringToString",
    "RtlUpperString",
    "RtlFreeAnsiString",
    "RtlFreeUnicodeString",
    "RtlUnicodeStringToInteger",
    "RtlDefaultNpAcl",
    "RtlCreateRegistryKey",
    "RtlQueryRegistryValues",
    "RtlWriteRegistryValue",
    "RtlCreateEnvironment",
    "RtlCreateEnvironmentEx",
    "RtlDestroyEnvironment",
    "RtlSetCurrentEnvironment",
    "RtlSetEnvironmentVar",
    "RtlSetEnvironmentVariable",
    "RtlQueryEnvironmentVariable",
    "RtlExpandEnvironmentStrings",
    "RtlSetEnvironmentStrings",
    "RtlGetCurrentTransaction",
    "RtlSetCurrentTransaction",
    "RtlCreateProcessParameters",
    "RtlCreateProcessParametersEx",
    "RtlDestroyProcessParameters",
    "RtlNormalizeProcessParams",
    "RtlDeNormalizeProcessParams",
    "RtlCreateUserProcess",
    "RtlCreateUserThread",
    "RtlExitUserThread",
    "RtlImageNtHeader",
    "RtlImageNtHeaderEx",
    "RtlImageDirectoryEntryToData",
    "RtlPcToFileHeader",
    "RtlAddressInSectionTable",
    "RtlImageRvaToSection",
    "RtlImageRvaToVa",
    "RtlQueryProcessHeapInformation",
    "RtlCreateQueryDebugBuffer",
    "RtlQueryProcessDebugInformation",
    "RtlRestoreContext",
    "RtlAdjustPrivilege",
    "RtlAcquirePrivilege",
    "RtlReleasePrivilege",
    "RtlReleaseRelativeName",
    "RtlNtPathNameToDosPathName",
    "RtlInitializeSRWLock",
    "RtlAcquireSRWLockExclusive",
    "RtlAcquireSRWLockShared",
    "RtlReleaseSRWLockExclusive",
    "RtlReleaseSRWLockShared",
    "RtlTryAcquireSRWLockExclusive",
    "RtlTryAcquireSRWLockShared",
    "RtlAcquireReleaseSRWLockExclusive",
    "RtlWalkFrameChain",
    "PfxFindPrefix",
    "PfxInitialize",
    "PfxInsertPrefix",
    "PfxRemovePrefix",
    "RtlAbsoluteToSelfRelativeSD",
    "RtlAddAccessAllowedAce",
    "RtlAddAccessAllowedAceEx",
    "RtlAddAce",
    "RtlAddAtomToAtomTable",
    "RtlAppendUnicodeStringToString",
    "RtlAreAllAccessesGranted",
    "RtlAreAnyAccessesGranted",
    "RtlAreBitsClear",
    "RtlAreBitsSet",
    "RtlCaptureContext",
    "RtlCaptureStackBackTrace",
    "RtlClearAllBits",
    "RtlClearBits",
    "RtlCreateSystemVolumeInformationFolder",
    "RtlCompareAltitudes",
    "RtlCompareUnicodeString",
    "RtlComputeCrc32",
    "RtlConvertSidToUnicodeString",
    "RtlCopyLuid",
    "RtlAllocateAndInitializeSid",
    "RtlAllocateAndInitializeSidEx",
    "RtlCopySid",
    "RtlCreateServiceSid",
    "RtlFreeSid",
    "RtlCreateAcl",
    "RtlCreateAtomTable",
    "RtlDelete",
    "RtlDeleteAce",
    "RtlDeleteAtomFromAtomTable",
    "RtlDeleteNoSplay",
    "RtlDowncaseUnicodeString",
    "RtlDuplicateUnicodeString",
    "RtlEmptyAtomTable",
    "RtlEqualSid",
    "RtlEqualString",
    "RtlEqualUnicodeString",
    "RtlFindClearBits",
    "RtlFindClearBitsAndSet",
    "RtlFindClearRuns",
    "RtlFindLastBackwardRunClear",
    "RtlFindLeastSignificantBit",
    "RtlFindLongestRunClear",
    "RtlFindMostSignificantBit",
    "RtlFindNextForwardRunClear",
    "RtlFindSetBits",
    "RtlFindSetBitsAndClear",
    "RtlGetCallersAddress",
    "RtlGetDaclSecurityDescriptor",
    "RtlGetGroupSecurityDescriptor",
    "RtlGetOwnerSecurityDescriptor",
    "RtlGetSaclSecurityDescriptor",
    "RtlGetSetBootStatusData",
    "RtlCreateBootStatusDataFile",
    "RtlGetVersion",
    "RtlGUIDFromString",
    "RtlHashUnicodeString",
    "RtlInitializeSid",
    "RtlLengthRequiredSid",
    "RtlLengthSecurityDescriptor",
    "RtlLengthSid",
    "RtlLockBootStatusData",
    "RtlLookupAtomInAtomTable",
    "RtlMapSecurityErrorToNtStatus",
    "RtlMultiByteToUnicodeN",
    "RtlMultiByteToUnicodeSize",
    "RtlNumberOfClearBits",
    "RtlNumberOfSetBits",
    "RtlQueryAtomInAtomTable",
    "RtlRealPredecessor",
    "RtlRealSuccessor",
    "RtlRunDecodeUnicodeString",
    "RtlRunEncodeUnicodeString",
    "RtlSelfRelativeToAbsoluteSD",
    "RtlSelfRelativeToAbsoluteSD2",
    "RtlSetAllBits",
    "RtlSetBits",
    "RtlSetDaclSecurityDescriptor",
    "RtlSetGroupSecurityDescriptor",
    "RtlSetOwnerSecurityDescriptor",
    "RtlSetSaclSecurityDescriptor",
    "RtlSplay",
    "RtlStringFromGUID",
    "RtlSubAuthorityCountSid",
    "RtlSubAuthoritySid",
    "RtlSubtreePredecessor",
    "RtlSubtreeSuccessor",
    "RtlTestBit",
    "RtlUnlockBootStatusData",
    "RtlCreateSecurityDescriptor",
    "RtlValidRelativeSecurityDescriptor",
    "RtlValidSecurityDescriptor",
    "RtlValidSid",
    "RtlVerifyVersionInfo",
    "VerSetConditionMask",
    "TpAllocPool",
    "TpDisablePoolCallbackChecks",
    "TpReleasePool",
    "TpSetPoolMaxThreads",
    "TpSetPoolMinThreads",
    "TpQueryPoolStackInformation",
    "TpSetPoolStackInformation",
    "TpAllocCleanupGroup",
    "TpReleaseCleanupGroup",
    "TpReleaseCleanupGroupMembers",
    "TpCallbackSetEventOnCompletion",
    "TpCallbackReleaseSemaphoreOnCompletion",
    "TpCallbackReleaseMutexOnCompletion",
    "TpCallbackLeaveCriticalSectionOnCompletion",
    "TpCallbackUnloadDllOnCompletion",
    "TpCallbackMayRunLong",
    "TpDisassociateCallback",
    "TpSimpleTryPost",
    "TpAllocWork",
    "TpReleaseWork",
    "TpPostWork",
    "TpWaitForWork",
    "TpAllocTimer",
    "TpReleaseTimer",
    "TpSetTimer",
    "TpSetTimerEx",
    "TpIsTimerSet",
    "TpWaitForTimer",
    "TpAllocWait",
    "TpReleaseWait",
    "TpSetWait",
    "TpSetWaitEx",
    "TpAllocIoCompletion",
    "TpWaitForIoCompletion",
    "TpAllocAlpcCompletion",
    "TpAllocAlpcCompletionEx",
    "TpReleaseAlpcCompletion",
    "TpWaitForAlpcCompletion",
    "TpAlpcRegisterCompletionList",
    "TpAlpcUnregisterCompletionList",
]

DLLS = [
    "Advapi32",
    "Kernel32",
    "Kernelbase",
    "Ntdll",
    "Wininet",
]

def hash_string(string: str, key: int) -> int:
    hash = 5381
    for x in (string.upper()):
        hash = ((hash << 5) + hash) + ord(x)
    return (hash & 0xffffffff) ^ (key & 0xffffffff)

def print_key(key: int) -> None:
    print("/**")
    print(" * @brief The key used to encrypt string hashes.")
    print(" */")
    print("#define MDK_KEY 0x%x" % (key))
    print()

def print_dlls(key: int) -> None:
    for dll in DLLS:
        print("/**")
        print(" * @brief The hash corresponding to %s.dll." % (dll))
        print(" */")
        print("#define MDK_HASH_%s 0x%x" % (dll, hash_string(dll + ".dll", key)))
        print()

def print_syscalls(key: int) -> None:
    for syscall in SYSCALLS:
        print("/**")
        print(" * @brief The hash corresponding to the %s syscall." % (syscall))
        print(" */")
        print("#define MDK_HASH_%s 0x%x" % (syscall, hash_string(syscall, key)))
        print()

def main(args: dict) -> None:
    print_key(args.key)
    print_dlls(args.key)
    print_syscalls(args.key)

if __name__ in '__main__':
    try:
        parser = argparse.ArgumentParser()
        parser.add_argument("--key", type=int, action="store", help="key used to encrypt hashes", default=0x12345678)
        args = parser.parse_args()
        main(args)
    except KeyboardInterrupt:
        exit()